---
import { getCollection } from 'astro:content';
const smrtiEntries = await getCollection('smrti');
const uniqueBooks = [...new Set(smrtiEntries.map(e => e.data.book))];
---

<div id="mega-menu" class="mega-menu-overlay">
  <div class="mega-menu-container">
    
    <nav class="mega-tabs">
      <button class="tab-btn active" data-target="read-section">Read</button>
      <button class="tab-btn" data-target="themes-section">Explore Themes</button>
      <button class="tab-btn" data-target="paths-section">Life Paths</button>
    </nav>

    <div id="read-section" class="mega-pane active">
      <div class="column-grid">
        <div class="col">
          <h4 class="label">Scripture Categories</h4>
          <ul class="nav-list">
            <li class="highlight">Åšruti (Vedas)</li>
            <li>Smá¹›ti</li>
            <li>ItihÄsa</li>
            <li>PurÄá¹‡a</li>
            <li>Ä€gama & Tantra</li>
            <li>VedÄá¹…ga</li>
            <li>Upaveda</li>
          </ul>
        </div>
        <div class="col">
          <h4 class="label">Texts</h4>
          <ul class="nav-list">
            <li><a href="#">á¹šg Veda</a></li>
            <li><a href="#">Yajur Veda</a></li>
            <li><a href="#">SÄma Veda</a></li>
            {uniqueBooks.map(book => (
              <li><a href="/vedic-site/smrti/dharma-shastra/manu-samhita/chapter-1/verse-103">{book}</a></li>
            ))}
          </ul>
        </div>
        <div class="col">
          <h4 class="label">Reading Guide</h4>
          <ul class="nav-list">
            <li><a href="#">How to Read</a></li>
            <li><a href="#">Traditional Structure</a></li>
            <li><a href="#">Recommended Order</a></li>
          </ul>
        </div>
        <div class="col status-col">
          <p class="meta-info italic">Sign in to track your reading progress</p>
        </div>
      </div>
    </div>

    <div id="themes-section" class="mega-pane">
      <div class="themes-visual-grid">
        <div class="theme-box"><span>ğŸ“š</span> Childhood & Education</div>
        <div class="theme-box"><span>ğŸ¡</span> Family & Life</div>
        <div class="theme-box"><span>ğŸ•‰ï¸</span> Spiritual Growth</div>
        <div class="theme-box"><span>ğŸ’­</span> Philosophy & Knowledge</div>
        <div class="theme-box"><span>ğŸŒ¿</span> Health & Living</div>
        <div class="theme-box"><span>ğŸŒ</span> Ecology & Dharma</div>
      </div>
    </div>
  </div>
</div>

<style>
  .mega-menu-overlay {
    position: absolute; /* Connects to header */
    top: 60px;
    left: 0;
    width: 100%;
    background: #FDFCF8; /* Parchment Light */
    border-bottom: 2px solid #8B0000; /* Vedic Crimson */
    display: none;
    z-index: 1000;
    padding: 2rem 0 4rem 0;
    box-shadow: 0 15px 30px rgba(0,0,0,0.08);
  }

  .mega-menu-container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; }

  .mega-tabs { display: flex; gap: 2.5rem; border-bottom: 1px solid #E6E2D3; margin-bottom: 2rem; }
  .tab-btn { background: none; border: none; padding: 1rem 0; cursor: pointer; color: #9A948C; font-family: 'Inter', sans-serif; }
  .tab-btn.active { color: #8B0000; border-bottom: 2px solid #8B0000; font-weight: 600; }

  /* THE COLUMN GRID FIX */
  .column-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 2rem; }
  
  .mega-pane { display: none; }
  .mega-pane.active { display: block; }

  .label { font-size: 0.7rem; color: #9A948C; text-transform: uppercase; margin-bottom: 1.5rem; letter-spacing: 0.05em; }
  .nav-list { list-style: none; padding: 0; }
  .nav-list li { margin-bottom: 0.8rem; font-family: 'Crimson Pro', serif; font-size: 1.1rem; }
  .nav-list a { text-decoration: none; color: #1A1A1A; }
  .nav-list a:hover { color: #8B0000; }
  .highlight { color: #8B0000; font-weight: 600; }

  /* THEMES VISUAL GRID */
  .themes-visual-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }
  .theme-box { border: 1px solid #E6E2D3; padding: 1.5rem; border-radius: 8px; background: white; text-align: center; }

  .italic { font-style: italic; color: #9A948C; }
</style>

<script>
  // Tab Switching Logic
  const tabs = document.querySelectorAll('.tab-btn');
  const panes = document.querySelectorAll('.mega-pane');

  tabs.forEach(tab => {
    tab.addEventListener('mouseenter', () => {
      tabs.forEach(t => t.classList.remove('active'));
      panes.forEach(p => p.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.target).classList.add('active');
    });
  });
</script>