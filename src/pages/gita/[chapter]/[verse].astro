---
import { getCollection } from 'astro:content';
import ReadingLayout from "../../../layouts/ReadingLayout.astro";
import VerseNavigation from "../../../components/VerseNavigation.astro";

// 1. Tell Astro which pages to build based on your folders
export async function getStaticPaths() {
  const entries = await getCollection('gita');
  return entries.map((entry) => {
    // Splits "chapter-2/verse-47" into two URL parameters
    const [chapterSlug, verseSlug] = entry.slug.split('/');
    return {
      params: { chapter: chapterSlug, verse: verseSlug },
      props: { entry },
    };
  });
}

// 2. Get the data for the specific page being viewed
const { entry } = Astro.props;
const { Content } = await entry.render();
const { title, book, chapter, verse } = entry.data;

// 3. Create Navigation links that work on ANY domain (Universal)
// We use "../" to move up one folder level from the current verse
const prev = verse > 1 ? {
  label: `Verse ${chapter}.${verse - 1}`,
  link: `../verse-${verse - 1}/`
} : null;

const next = {
  label: `Verse ${chapter}.${verse + 1}`,
  link: `../verse-${verse + 1}/`
};
---

<ReadingLayout 
  title={title} 
  subtitle={`${book} Â· Chapter ${chapter} Â· Verse ${verse}`}
>
  <article>
    <Content />
  </article>
  
  <VerseNavigation prev={prev} next={next} />
</ReadingLayout>